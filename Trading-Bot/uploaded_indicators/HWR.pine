//@version=5
indicator("High Win Rate Indicator", overlay=true)

// Input Parameters
shortEMA = input(9, title="Short EMA Period")
longEMA = input(21, title="Long EMA Period")
atrPeriod = input(14, title="ATR Period")
atrMult = input(2, title="ATR Multiplier")
rsiPeriod = input(14, title="RSI Period")

// EMA Calculations
emaShort = ta.ema(close, shortEMA)
emaLong = ta.ema(close, longEMA)

// ATR and Trailing Stop
xATR = ta.atr(atrPeriod)
atrStop = close - atrMult * xATR
atrLong = close + atrMult * xATR

// RSI Calculation
rsi = ta.rsi(close, rsiPeriod)

// Buy and Sell Conditions
buyCondition = ta.crossover(emaShort, emaLong) and rsi > 50
sellCondition = ta.crossunder(emaShort, emaLong) and rsi < 50

// Exit Conditions
exitLong = close < atrStop
exitShort = close > atrLong

// Plot Buy and Sell Signals
plotshape(buyCondition, title="Buy Signal", location=location.belowbar, color=color.green, text="BUY", textcolor=color.white)
plotshape(sellCondition, title="Sell Signal", location=location.abovebar, color=color.red, text="SELL", textcolor=color.white)
plotshape(exitLong, title="Exit Long", location=location.abovebar, color=color.orange, text="EXIT", textcolor=color.white)
plotshape(exitShort, title="Exit Short", location=location.belowbar, color=color.orange, text="EXIT", textcolor=color.white)

// Plot EMA and ATR Stop for Visualization
plot(emaShort, color=color.blue, title="Short EMA")
plot(emaLong, color=color.red, title="Long EMA")
hline(50, "RSI 50 Level", color=color.gray)
